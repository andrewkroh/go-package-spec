tables:
  packages:
    type: Manifest
    comment: "Fleet packages (integration, input, or content). Each row is one package version."
    extra_columns:
      dir_name:
        type: TEXT
        not_null: true
        unique: true
        comment: "directory name of the package"
      conditions_kibana_version:
        type: TEXT
        comment: "required Kibana version range"
      conditions_elastic_subscription:
        type: TEXT
        comment: "required Elastic subscription level"
      agent_privileges_root:
        type: BOOLEAN
        comment: "whether collection requires root privileges in the agent"
      elasticsearch_privileges_cluster:
        type: JSON
        comment: "Elasticsearch cluster privilege requirements (JSON array)"
      policy_templates_behavior:
        type: TEXT
        comment: "behavior when multiple policy templates are defined (all, combined_policy, individual_policies)"
    inline:
      - Owner
      - Source
      - Deprecated
      - Deprecated.ReplacedBy
    exclude:
      - Categories
      - Icons
      - Screenshots
    columns:
      deprecated_description:
        not_null: false
      deprecated_since:
        not_null: false

  package_categories:
    comment: "Categories assigned to a package."
    extra_columns:
      package_id:
        type: INTEGER
        not_null: true
        fk: packages
        comment: "foreign key to packages"
      category:
        type: TEXT
        not_null: true
        comment: "category value"

  package_icons:
    type: Icon
    parent: packages
    comment: "Icon definitions for a package."

  package_screenshots:
    type: Screenshot
    parent: packages
    comment: "Screenshot definitions for a package."

  changelogs:
    type: Changelog
    parent: packages
    comment: "Changelog versions for a package. Each row is one version entry with its release date."
    exclude:
      - Changes

  changelog_entries:
    type: ChangelogEntry
    parent: changelogs
    comment: "Individual changelog entries within a changelog version."

  policy_templates:
    type: PolicyTemplate
    parent: packages
    comment: "Policy templates offered by integration packages. Defines how an integration is configured in Fleet."
    exclude:
      - Categories
      - Icons
      - Screenshots
      - Inputs
      - Vars
    inline:
      - DeploymentModes
      - DeploymentModes.Default
      - DeploymentModes.Agentless
      - DeploymentModes.Agentless.Resources
      - DeploymentModes.Agentless.Resources.Requests
      - Deprecated
      - Deprecated.ReplacedBy
    json_columns:
      - ConfigurationLinks
    columns:
      deprecated_description:
        not_null: false
      deprecated_since:
        not_null: false

  policy_template_categories:
    comment: "Categories assigned to a policy template."
    extra_columns:
      policy_template_id:
        type: INTEGER
        not_null: true
        fk: policy_templates
        comment: "foreign key to policy_templates"
      category:
        type: TEXT
        not_null: true
        comment: "category value"

  policy_template_icons:
    type: Icon
    parent: policy_templates
    comment: "Icon definitions for a policy template."

  policy_template_screenshots:
    type: Screenshot
    parent: policy_templates
    comment: "Screenshot definitions for a policy template."

  policy_template_inputs:
    type: PolicyTemplateInput
    parent: policy_templates
    comment: "Inputs defined within a policy template."
    exclude:
      - Vars
      - RequiredVars
    inline:
      - Deprecated
      - Deprecated.ReplacedBy
    json_columns:
      - DeploymentModes
      - HideInVarGroupOptions
    columns:
      deprecated_description:
        not_null: false
      deprecated_since:
        not_null: false

  data_streams:
    type: DataStreamManifest
    parent: packages
    comment: "Data streams within integration packages. Each row is one data stream with its Elasticsearch and agent config."
    extra_columns:
      dir_name:
        type: TEXT
        not_null: true
        comment: "directory name of the data stream"
    inline:
      - Elasticsearch
      - Deprecated
      - Deprecated.ReplacedBy
    exclude:
      - Streams
      - Categories
      - Agent
    json_columns:
      - Elasticsearch.IndexTemplate
      - Elasticsearch.Privileges
    columns:
      deprecated_description:
        not_null: false
      deprecated_since:
        not_null: false

  sample_events:
    comment: "Sample event data for data streams."
    extra_columns:
      data_streams_id:
        type: INTEGER
        not_null: true
        fk: data_streams
        comment: "foreign key to data_streams"
      event:
        type: JSON
        not_null: true
        comment: "sample event data (JSON)"

  streams:
    type: DataStreamStream
    parent: data_streams
    comment: "Streams offered by a data stream."
    exclude:
      - Vars
      - VarGroups
      - RequiredVars

  vars:
    type: Var
    comment: "Input variable definitions. Linked to packages, policy templates, streams, or inputs via join tables."
    exclude:
      - Deprecated
    json_columns:
      - Default
      - Options
      - HideInDeploymentModes
      - URLAllowedSchemes

  package_vars:
    comment: "Join table linking vars to packages."
    extra_columns:
      package_id:
        type: INTEGER
        not_null: true
        fk: packages
        comment: "foreign key to packages"
      var_id:
        type: INTEGER
        not_null: true
        fk: vars
        comment: "foreign key to vars"

  policy_template_vars:
    comment: "Join table linking vars to policy templates."
    extra_columns:
      policy_template_id:
        type: INTEGER
        not_null: true
        fk: policy_templates
        comment: "foreign key to policy_templates"
      var_id:
        type: INTEGER
        not_null: true
        fk: vars
        comment: "foreign key to vars"

  policy_template_input_vars:
    comment: "Join table linking vars to policy template inputs."
    extra_columns:
      policy_template_input_id:
        type: INTEGER
        not_null: true
        fk: policy_template_inputs
        comment: "foreign key to policy_template_inputs"
      var_id:
        type: INTEGER
        not_null: true
        fk: vars
        comment: "foreign key to vars"

  stream_vars:
    comment: "Join table linking vars to streams."
    extra_columns:
      stream_id:
        type: INTEGER
        not_null: true
        fk: streams
        comment: "foreign key to streams"
      var_id:
        type: INTEGER
        not_null: true
        fk: vars
        comment: "foreign key to vars"

  fields:
    type: FlatField
    comment: "Elasticsearch field definitions, flattened from nested YAML into dotted-path names."
    flatten: true
    exclude:
      - Fields
      - ECS
    json_columns:
      - DefaultMetric
      - Dynamic
      - Example
      - ExpectedValues
      - Metrics
      - MultiFields
      - Normalize
      - NullValue
      - Runtime

  data_stream_fields:
    comment: "Join table linking fields to data streams."
    extra_columns:
      data_stream_id:
        type: INTEGER
        not_null: true
        fk: data_streams
        comment: "foreign key to data_streams"
      field_id:
        type: INTEGER
        not_null: true
        fk: fields
        comment: "foreign key to fields"

  package_fields:
    comment: "Join table linking fields to packages (for input packages)."
    extra_columns:
      package_id:
        type: INTEGER
        not_null: true
        fk: packages
        comment: "foreign key to packages"
      field_id:
        type: INTEGER
        not_null: true
        fk: fields
        comment: "foreign key to fields"

  transform_fields:
    comment: "Join table linking fields to transforms."
    extra_columns:
      transform_id:
        type: INTEGER
        not_null: true
        fk: transforms
        comment: "foreign key to transforms"
      field_id:
        type: INTEGER
        not_null: true
        fk: fields
        comment: "foreign key to fields"

  ingest_pipelines:
    type: IngestPipeline
    parent: data_streams
    comment: "Elasticsearch ingest pipeline definitions within data streams."
    extra_columns:
      file_name:
        type: TEXT
        not_null: true
        comment: "file name of the pipeline (e.g. default.yml)"
    exclude:
      - Processors
      - OnFailure

  ingest_processors:
    type: Processor
    parent: ingest_pipelines
    comment: "Individual ingest processors flattened from pipelines. Nested on_failure handlers are included as separate rows."
    flatten: true
    extra_columns:
      type:
        type: TEXT
        not_null: true
        comment: "processor type (e.g. set, grok, rename)"
      attributes:
        type: JSON
        comment: "JSON-encoded processor attributes"
      json_pointer:
        type: TEXT
        not_null: true
        comment: "RFC 6901 JSON Pointer location within the pipeline"
      ordinal:
        type: INTEGER
        not_null: true
        comment: "order of processor within the pipeline"

  transforms:
    type: Transform
    parent: packages
    comment: "Elasticsearch transform configurations within integration packages."
    extra_columns:
      dir_name:
        type: TEXT
        not_null: true
        comment: "directory name of the transform"
      manifest_start:
        type: BOOLEAN
        comment: "whether to start the transform upon installation"
      manifest_destination_index_template:
        type: JSON
        comment: "Elasticsearch index template for the transform destination (JSON)"
    exclude:
      - ID
    json_columns:
      - Meta
      - Source
      - Dest
      - Pivot
      - Latest
      - Settings
      - RetentionPolicy
      - Sync

  routing_rules:
    type: RoutingRule
    parent: data_streams
    comment: "Routing rules for rerouting documents from a source dataset (technical preview)."
    json_columns:
      - Namespace
      - TargetDataset

  tags:
    type: Tag
    parent: packages
    comment: "Kibana tags associated with integration packages."
    json_columns:
      - AssetIDs
      - AssetTypes

  images:
    comment: "Image files within packages (img/ directory). Join with icon/screenshot tables on src to correlate declared metadata with actual image properties."
    extra_columns:
      packages_id:
        type: INTEGER
        not_null: true
        fk: packages
        comment: "foreign key to packages"
      src:
        type: TEXT
        not_null: true
        comment: "image path with leading slash to match icon/screenshot src (e.g. /img/icon.png)"
      width:
        type: INTEGER
        comment: "image width in pixels (NULL for SVG)"
      height:
        type: INTEGER
        comment: "image height in pixels (NULL for SVG)"
      byte_size:
        type: INTEGER
        not_null: true
        comment: "file size in bytes"
      sha256:
        type: TEXT
        not_null: true
        comment: "hex-encoded SHA-256 hash of file contents"

  discovery_fields:
    comment: "Fields associated with package discovery capabilities."
    extra_columns:
      packages_id:
        type: INTEGER
        not_null: true
        fk: packages
        comment: "foreign key to packages"
      name:
        type: TEXT
        not_null: true
        comment: "name of the field"

  build_manifests:
    type: BuildManifest
    parent: packages
    comment: "Build configuration for integration packages (_dev/build/build.yml)."
    inline:
      - Dependencies
      - Dependencies.ECS
