tables:
  packages:
    type: Manifest
    comment: "Fleet packages (integration, input, or content). Each row is one package version."
    extra_columns:
      dir_name:
        type: TEXT
        not_null: true
        unique: true
        comment: "directory name of the package"
      conditions_kibana_version:
        type: TEXT
        comment: "required Kibana version range"
      conditions_elastic_subscription:
        type: TEXT
        comment: "required Elastic subscription level"
      agent_privileges_root:
        type: BOOLEAN
        comment: "whether collection requires root privileges in the agent"
      elasticsearch_privileges_cluster:
        type: JSON
        comment: "Elasticsearch cluster privilege requirements (JSON array)"
      policy_templates_behavior:
        type: TEXT
        comment: "behavior when multiple policy templates are defined (all, combined_policy, individual_policies)"
      commit_id:
        type: TEXT
        comment: "git HEAD commit ID (populated when WithGitMetadata is used)"
    inline:
      - Owner
      - Source
    exclude:
      - Categories
      - Icons
      - Screenshots
      - Deprecated

  package_categories:
    comment: "Categories assigned to a package."
    extra_columns:
      package_id:
        type: INTEGER
        not_null: true
        fk: packages
        comment: "foreign key to packages"
      category:
        type: TEXT
        not_null: true
        comment: "category value"

  package_icons:
    type: Icon
    parent: packages
    comment: "Icon definitions for a package."

  package_screenshots:
    type: Screenshot
    parent: packages
    comment: "Screenshot definitions for a package."

  changelogs:
    type: Changelog
    parent: packages
    comment: "Changelog versions for a package. Each row is one version entry with its release date."
    exclude:
      - Changes

  changelog_entries:
    type: ChangelogEntry
    parent: changelogs
    comment: "Individual changelog entries within a changelog version."

  policy_templates:
    type: PolicyTemplate
    parent: packages
    comment: "Policy templates offered by integration and input packages. Defines how a package is configured in Fleet."
    extra_columns:
      input:
        type: TEXT
        comment: "input type for input packages (e.g. cel, httpjson)"
      template_path:
        type: TEXT
        comment: >-
          Resolved file path to the agent template relative to the package
          root (e.g. agent/input/input.yml.hbs). Only set for input packages.
          Joinable directly to agent_templates.file_path.
      policy_template_type:
        type: TEXT
        comment: "data stream type for input packages (logs, metrics, synthetics, traces)"
      dynamic_signal_types:
        type: BOOLEAN
        comment: "whether transforms and index templates are created based on pipeline config (input packages only)"
    exclude:
      - Categories
      - Icons
      - Screenshots
      - Inputs
      - Vars
      - Deprecated
    inline:
      - DeploymentModes
      - DeploymentModes.Default
      - DeploymentModes.Agentless
      - DeploymentModes.Agentless.Resources
      - DeploymentModes.Agentless.Resources.Requests
    json_columns:
      - ConfigurationLinks

  policy_template_categories:
    comment: "Categories assigned to a policy template."
    extra_columns:
      policy_template_id:
        type: INTEGER
        not_null: true
        fk: policy_templates
        comment: "foreign key to policy_templates"
      category:
        type: TEXT
        not_null: true
        comment: "category value"

  policy_template_icons:
    type: Icon
    parent: policy_templates
    comment: "Icon definitions for a policy template."

  policy_template_screenshots:
    type: Screenshot
    parent: policy_templates
    comment: "Screenshot definitions for a policy template."

  policy_template_inputs:
    type: PolicyTemplateInput
    parent: policy_templates
    comment: "Inputs defined within a policy template."
    columns:
      template_path:
        comment: >-
          Resolved file path to the agent template relative to the package
          root (e.g. agent/input/httpjson.yml.hbs). NULL when not
          specified. Joinable directly to agent_templates.file_path.
    exclude:
      - Vars
      - RequiredVars
      - Deprecated
    json_columns:
      - DeploymentModes
      - HideInVarGroupOptions

  data_streams:
    type: DataStreamManifest
    parent: packages
    comment: "Data streams within integration packages. Each row is one data stream with its Elasticsearch and agent config."
    extra_columns:
      dir_name:
        type: TEXT
        not_null: true
        comment: "directory name of the data stream"
    inline:
      - Elasticsearch
    exclude:
      - Streams
      - Categories
      - Agent
      - Deprecated
    json_columns:
      - Elasticsearch.IndexTemplate
      - Elasticsearch.Privileges

  sample_events:
    comment: "Sample event data for data streams."
    extra_columns:
      data_streams_id:
        type: INTEGER
        not_null: true
        fk: data_streams
        comment: "foreign key to data_streams"
      event:
        type: JSON
        not_null: true
        comment: "sample event data (JSON)"

  streams:
    type: DataStreamStream
    parent: data_streams
    comment: "Streams offered by a data stream."
    columns:
      template_path:
        comment: >-
          Resolved file path to the agent template relative to the package
          root (e.g. data_stream/logs/agent/stream/stream.yml.hbs). Defaults
          to stream.yml.hbs when not specified in the manifest. Joinable
          directly to agent_templates.file_path.
    exclude:
      - Vars
      - VarGroups
      - RequiredVars

  vars:
    type: Var
    comment: "Input variable definitions. Linked to packages, policy templates, streams, or inputs via join tables."
    exclude:
      - Deprecated
    json_columns:
      - Default
      - Options
      - HideInDeploymentModes
      - URLAllowedSchemes

  package_vars:
    comment: "Join table linking vars to packages."
    extra_columns:
      package_id:
        type: INTEGER
        not_null: true
        fk: packages
        comment: "foreign key to packages"
      var_id:
        type: INTEGER
        not_null: true
        fk: vars
        comment: "foreign key to vars"

  policy_template_vars:
    comment: "Join table linking vars to policy templates."
    extra_columns:
      policy_template_id:
        type: INTEGER
        not_null: true
        fk: policy_templates
        comment: "foreign key to policy_templates"
      var_id:
        type: INTEGER
        not_null: true
        fk: vars
        comment: "foreign key to vars"

  policy_template_input_vars:
    comment: "Join table linking vars to policy template inputs."
    extra_columns:
      policy_template_input_id:
        type: INTEGER
        not_null: true
        fk: policy_template_inputs
        comment: "foreign key to policy_template_inputs"
      var_id:
        type: INTEGER
        not_null: true
        fk: vars
        comment: "foreign key to vars"

  stream_vars:
    comment: "Join table linking vars to streams."
    extra_columns:
      stream_id:
        type: INTEGER
        not_null: true
        fk: streams
        comment: "foreign key to streams"
      var_id:
        type: INTEGER
        not_null: true
        fk: vars
        comment: "foreign key to vars"

  fields:
    type: FlatField
    comment: "Elasticsearch field definitions, flattened from nested YAML into dotted-path names."
    flatten: true
    exclude:
      - Fields
      - ECS
    json_columns:
      - DefaultMetric
      - Dynamic
      - Example
      - ExpectedValues
      - Metrics
      - MultiFields
      - Normalize
      - NullValue
      - Runtime

  data_stream_fields:
    comment: "Join table linking fields to data streams."
    extra_columns:
      data_stream_id:
        type: INTEGER
        not_null: true
        fk: data_streams
        comment: "foreign key to data_streams"
      field_id:
        type: INTEGER
        not_null: true
        fk: fields
        comment: "foreign key to fields"

  package_fields:
    comment: "Join table linking fields to packages (for input packages)."
    extra_columns:
      package_id:
        type: INTEGER
        not_null: true
        fk: packages
        comment: "foreign key to packages"
      field_id:
        type: INTEGER
        not_null: true
        fk: fields
        comment: "foreign key to fields"

  transform_fields:
    comment: "Join table linking fields to transforms."
    extra_columns:
      transform_id:
        type: INTEGER
        not_null: true
        fk: transforms
        comment: "foreign key to transforms"
      field_id:
        type: INTEGER
        not_null: true
        fk: fields
        comment: "foreign key to fields"

  ingest_pipelines:
    type: IngestPipeline
    parent: data_streams
    comment: "Elasticsearch ingest pipeline definitions within data streams."
    extra_columns:
      file_name:
        type: TEXT
        not_null: true
        comment: "file name of the pipeline (e.g. default.yml)"
    exclude:
      - Processors
      - OnFailure

  ingest_processors:
    type: Processor
    parent: ingest_pipelines
    comment: "Individual ingest processors flattened from pipelines. Nested on_failure handlers are included as separate rows."
    flatten: true
    extra_columns:
      type:
        type: TEXT
        not_null: true
        comment: "processor type (e.g. set, grok, rename)"
      attributes:
        type: JSON
        comment: "JSON-encoded processor attributes"
      json_pointer:
        type: TEXT
        not_null: true
        comment: "RFC 6901 JSON Pointer location within the pipeline"
      ordinal:
        type: INTEGER
        not_null: true
        comment: "order of processor within the pipeline"

  transforms:
    type: Transform
    parent: packages
    comment: "Elasticsearch transform configurations within integration packages."
    extra_columns:
      dir_name:
        type: TEXT
        not_null: true
        comment: "directory name of the transform"
      manifest_start:
        type: BOOLEAN
        comment: "whether to start the transform upon installation"
      manifest_destination_index_template:
        type: JSON
        comment: "Elasticsearch index template for the transform destination (JSON)"
    exclude:
      - ID
    json_columns:
      - Meta
      - Source
      - Dest
      - Pivot
      - Latest
      - Settings
      - RetentionPolicy
      - Sync

  routing_rules:
    type: RoutingRule
    parent: data_streams
    comment: "Routing rules for rerouting documents from a source dataset (technical preview)."
    json_columns:
      - Namespace
      - TargetDataset

  tags:
    type: Tag
    parent: packages
    comment: "Kibana tags associated with integration packages."
    json_columns:
      - AssetIDs
      - AssetTypes

  images:
    comment: "Image files within packages (img/ directory). Join with icon/screenshot tables on src to correlate declared metadata with actual image properties."
    extra_columns:
      packages_id:
        type: INTEGER
        not_null: true
        fk: packages
        comment: "foreign key to packages"
      src:
        type: TEXT
        not_null: true
        comment: "image path with leading slash to match icon/screenshot src (e.g. /img/icon.png)"
      width:
        type: INTEGER
        comment: "image width in pixels (NULL for SVG)"
      height:
        type: INTEGER
        comment: "image height in pixels (NULL for SVG)"
      byte_size:
        type: INTEGER
        not_null: true
        comment: "file size in bytes"
      sha256:
        type: TEXT
        not_null: true
        comment: "hex-encoded SHA-256 hash of file contents"

  discovery_fields:
    comment: "Fields associated with package discovery capabilities."
    extra_columns:
      packages_id:
        type: INTEGER
        not_null: true
        fk: packages
        comment: "foreign key to packages"
      name:
        type: TEXT
        not_null: true
        comment: "name of the field"

  build_manifests:
    type: BuildManifest
    parent: packages
    comment: "Build configuration for integration packages (_dev/build/build.yml)."
    inline:
      - Dependencies
      - Dependencies.ECS

  pipeline_tests:
    comment: "Pipeline test cases for data streams. Each row is one test event file with optional per-case config."
    extra_columns:
      data_streams_id:
        type: INTEGER
        not_null: true
        fk: data_streams
        comment: "foreign key to data_streams"
      name:
        type: TEXT
        not_null: true
        comment: "test case stem name (e.g. test-example)"
      format:
        type: TEXT
        not_null: true
        comment: "event file format (json or raw)"
      event_path:
        type: TEXT
        not_null: true
        comment: "path to event file"
      expected_path:
        type: TEXT
        comment: "path to expected output file"
      config_path:
        type: TEXT
        comment: "path to per-case config file"
      skip_link:
        type: TEXT
        comment: "link to issue for skipped test (from per-case config)"
      skip_reason:
        type: TEXT
        comment: "reason test is skipped (from per-case config)"
      dynamic_fields:
        type: JSON
        comment: "dynamic fields with regex patterns (from per-case config)"
      fields:
        type: JSON
        comment: "field definitions (from per-case config)"
      numeric_keyword_fields:
        type: JSON
        comment: "keyword fields allowed numeric values (from per-case config)"
      string_number_fields:
        type: JSON
        comment: "numeric fields allowed string values (from per-case config)"
      multiline:
        type: JSON
        comment: "multi-line configuration (from per-case raw config)"

  system_tests:
    type: SystemTestConfig
    comment: "System test cases for data streams and input packages."
    extra_columns:
      data_streams_id:
        type: INTEGER
        fk: data_streams
        comment: "foreign key to data_streams (set for integration packages)"
      packages_id:
        type: INTEGER
        fk: packages
        comment: "foreign key to packages (set for input packages)"
      case_name:
        type: TEXT
        not_null: true
        comment: "test case name extracted from filename"
    inline:
      - Skip
      - Agent
      - Agent.PreStartScript
      - Agent.ProvisioningScript
    json_columns:
      - Agent.LinuxCapabilities
      - Agent.Ports
      - DataStream
      - Vars
      - SkipIgnoredFields

  static_tests:
    type: StaticTestConfig
    comment: "Static test cases for data streams."
    extra_columns:
      data_streams_id:
        type: INTEGER
        not_null: true
        fk: data_streams
        comment: "foreign key to data_streams"
      case_name:
        type: TEXT
        not_null: true
        comment: "test case name extracted from filename"
    inline:
      - Skip

  policy_tests:
    type: PolicyTestConfig
    comment: "Policy test cases for data streams and input packages."
    extra_columns:
      data_streams_id:
        type: INTEGER
        fk: data_streams
        comment: "foreign key to data_streams (set for integration packages)"
      packages_id:
        type: INTEGER
        fk: packages
        comment: "foreign key to packages (set for input packages)"
      case_name:
        type: TEXT
        not_null: true
        comment: "test case name extracted from filename"
    inline:
      - Skip
    json_columns:
      - DataStream
      - Vars

  deprecations:
    comment: "Deprecation notices for packages, policy templates, inputs, data streams, and vars. Each row links to exactly one parent entity via a nullable FK."
    extra_columns:
      packages_id:
        type: INTEGER
        fk: packages
        comment: "foreign key to packages (set when a package is deprecated)"
      policy_templates_id:
        type: INTEGER
        fk: policy_templates
        comment: "foreign key to policy_templates (set when a policy template is deprecated)"
      policy_template_inputs_id:
        type: INTEGER
        fk: policy_template_inputs
        comment: "foreign key to policy_template_inputs (set when an input is deprecated)"
      data_streams_id:
        type: INTEGER
        fk: data_streams
        comment: "foreign key to data_streams (set when a data stream is deprecated)"
      vars_id:
        type: INTEGER
        fk: vars
        comment: "foreign key to vars (set when a var is deprecated)"
      description:
        type: TEXT
        not_null: true
        comment: "reason for deprecation"
      since:
        type: TEXT
        not_null: true
        comment: "version since when deprecated"
      replaced_by_data_stream:
        type: TEXT
        comment: "name of the data stream that replaces the deprecated one"
      replaced_by_input:
        type: TEXT
        comment: "name of the input that replaces the deprecated one"
      replaced_by_package:
        type: TEXT
        comment: "name of the package that replaces the deprecated one"
      replaced_by_policy_template:
        type: TEXT
        comment: "name of the policy template that replaces the deprecated one"
      replaced_by_variable:
        type: TEXT
        comment: "name of the variable that replaces the deprecated one"

  kibana_saved_objects:
    comment: >-
      Kibana saved objects (dashboards, visualizations, security rules, etc.)
      from the kibana/ directory. Each row is one JSON file.
    extra_columns:
      packages_id:
        type: INTEGER
        not_null: true
        fk: packages
        comment: "foreign key to packages"
      asset_type:
        type: TEXT
        not_null: true
        comment: "asset type directory name (e.g. dashboard, visualization, security_rule)"
      object_id:
        type: TEXT
        not_null: true
        comment: "unique identifier of the saved object"
      object_type:
        type: TEXT
        comment: "object type from JSON (e.g. dashboard, visualization, search)"
      title:
        type: TEXT
        comment: "human-readable title from attributes"
      description:
        type: TEXT
        comment: "description from attributes"
      file_path:
        type: TEXT
        not_null: true
        comment: "file path relative to the package root"
      core_migration_version:
        type: TEXT
        comment: "core Kibana migration version"
      type_migration_version:
        type: TEXT
        comment: "type-specific migration version"
      managed:
        type: BOOLEAN
        comment: "whether the object is managed by Kibana"
      reference_count:
        type: INTEGER
        not_null: true
        comment: "number of references to other saved objects"

  kibana_references:
    comment: >-
      References between Kibana saved objects. Each row is one reference from
      a saved object to another, enabling dependency graph queries.
    extra_columns:
      kibana_saved_objects_id:
        type: INTEGER
        not_null: true
        fk: kibana_saved_objects
        comment: "foreign key to kibana_saved_objects"
      ref_id:
        type: TEXT
        not_null: true
        comment: "referenced object identifier"
      ref_name:
        type: TEXT
        not_null: true
        comment: "reference name (e.g. panel_0, kibanaSavedObjectMeta.searchSourceJSON)"
      ref_type:
        type: TEXT
        not_null: true
        comment: "referenced object type (e.g. visualization, search, index-pattern)"

  agent_templates:
    comment: >-
      Agent Handlebars template files (.yml.hbs) from agent/ directories.
      Each row is one template file with its raw content. Referenced by
      streams, policy_templates, and policy_template_inputs via template_path.
    extra_columns:
      packages_id:
        type: INTEGER
        not_null: true
        fk: packages
        comment: "foreign key to packages"
      data_streams_id:
        type: INTEGER
        fk: data_streams
        comment: "foreign key to data_streams (set for data stream templates, NULL for package-level)"
      file_path:
        type: TEXT
        not_null: true
        comment: "file path relative to the package root (e.g. data_stream/logs/agent/stream/stream.yml.hbs)"
      content:
        type: TEXT
        not_null: true
        comment: "raw Handlebars template content"

  docs:
    comment: >-
      Documentation files within packages.
      Content is optionally populated when WithDocContent is used.
    extra_columns:
      packages_id:
        type: INTEGER
        not_null: true
        fk: packages
        comment: "foreign key to packages"
      file_path:
        type: TEXT
        not_null: true
        comment: "file path relative to the package root (e.g. docs/README.md)"
      content_type:
        type: TEXT
        not_null: true
        comment: "classification: readme, doc, or knowledge_base"
      content:
        type: TEXT
        comment: "markdown content (NULL unless WithDocContent was used)"
